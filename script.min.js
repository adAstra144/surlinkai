const scanBtn=document.getElementById("scanBtn"),messageInput=document.getElementById("messageInput"),chatWindow=document.getElementById("chatWindow"),progressBar=document.getElementById("progressBar"),historyList=document.getElementById("historyList"),totalScansEl=document.getElementById("totalScans"),phishingScansEl=document.getElementById("phishingScans"),safeScansEl=document.getElementById("safeScans"),statusIndicator=document.getElementById("statusIndicator"),statusText=document.getElementById("statusText");let scrollTimeout,totalScans=0,phishingScans=0,safeScans=0,apiUrl="https://adastra144-anti-phishing-scanner-0.hf.space",explainerUrl="",isScanning=!1;function addParticleEffect(){const e=document.createElement("div");e.className="particles",e.innerHTML=Array.from({length:10},(()=>'<div class="particle"></div>')).join(""),document.body.appendChild(e)}function setupAccessibility(){document.querySelectorAll(".example-messages li").forEach(((e,t)=>{e.setAttribute("tabindex","0"),e.setAttribute("role","button"),e.setAttribute("aria-label",`Example ${t+1}: ${e.textContent}`),e.addEventListener("keydown",(t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),messageInput.value=e.textContent,messageInput.focus(),addRippleEffect(t.target))})),e.addEventListener("click",(t=>{messageInput.value=e.textContent,messageInput.focus(),addRippleEffect(t.target)}))}))}function addRippleEffect(e){const t=document.createElement("span");t.className="ripple",e.appendChild(t),setTimeout((()=>{t.remove()}),600)}function setupEventListeners(){scanBtn.addEventListener("click",(e=>{addRippleEffect(e.target),scanMessage()})),messageInput.addEventListener("keydown",(e=>{(e.ctrlKey||e.metaKey)&&"Enter"===e.key&&(e.preventDefault(),scanMessage())})),messageInput.addEventListener("input",(()=>{messageInput.style.height="auto",messageInput.style.height=Math.min(messageInput.scrollHeight,200)+"px",adjustChatBottomPadding();try{chatWindow.scrollTop=chatWindow.scrollHeight}catch(e){}})),messageInput.addEventListener("focus",(()=>{const e=chatWindow.querySelector(".welcome-message");e&&(e.style.opacity="0.7"),adjustChatBottomPadding()}))}function adjustChatBottomPadding(){const e=document.querySelector(".input-area");if(!e)return;const t=window.getComputedStyle(e),n=e.offsetHeight+parseFloat(t.marginTop||0)+parseFloat(t.marginBottom||0),a=parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--keyboard-offset"))||0,s=Math.max(160,n+48+a);chatWindow.style.paddingBottom=`${s}px`}function setupMobileMenu(){const e=document.getElementById("menuToggle"),t=document.getElementById("sidebar"),n=document.getElementById("backdrop");if(!e||!t||!n)return;window.matchMedia("(min-width: 1025px)").matches?(t.classList.remove("collapsed"),e.setAttribute("aria-expanded","true")):(t.classList.remove("open"),n.hidden=!0,n.style.pointerEvents="none",document.body.classList.remove("no-scroll"),e.setAttribute("aria-expanded","false"));const a=()=>{t.classList.remove("open"),n.hidden=!0,n.style.pointerEvents="none",document.body.classList.remove("no-scroll"),e.setAttribute("aria-expanded","false")};e.addEventListener("click",(()=>{if(window.matchMedia("(min-width: 1025px)").matches)return t.classList.toggle("collapsed"),void e.setAttribute("aria-expanded",!t.classList.contains("collapsed"));!t.classList.contains("open")?(t.classList.add("open"),n.hidden=!1,n.style.pointerEvents="auto",document.body.classList.add("no-scroll"),e.setAttribute("aria-expanded","true")):a()})),n.addEventListener("click",(e=>{t.contains(e.target)||a()})),t.addEventListener("click",(e=>{e.stopPropagation()})),window.matchMedia("(min-width: 1025px)").addEventListener("change",(s=>{s.matches?(t.classList.remove("open"),n.hidden=!0,n.style.pointerEvents="none",document.body.classList.remove("no-scroll"),t.classList.remove("collapsed"),e.setAttribute("aria-expanded","true")):(t.classList.remove("collapsed"),a())})),document.addEventListener("keydown",(e=>{"Escape"===e.key&&a()}));Array.from(document.querySelectorAll(".nav-btn")).forEach((e=>{const t=e.cloneNode(!0);e.parentNode.replaceChild(t,e)})),document.querySelectorAll(".nav-btn").forEach((e=>{e.addEventListener("click",(t=>{t.stopPropagation();const n=e.getAttribute("data-section")||e.dataset.section;n&&showSection(n),window.matchMedia("(max-width: 1024px)").matches&&setTimeout(a,150)}),{passive:!0})}))}function showSection(e){document.querySelectorAll(".content-section").forEach((e=>e.classList.remove("active")));document.querySelectorAll(".nav-btn").forEach((e=>e.classList.remove("active")));let t="";switch(e){case"chat":t="chatSection";break;case"history":t="historyMainSection";break;case"stats":t="statsMainSection";break;case"status":t="statusMainSection";break;case"quiz":t="quizMainSection";break;case"feedback":t="feedbackMainSection"}const n=document.getElementById(t);n.classList.add("active");const a=document.querySelector(`[onclick="showSection('${e}')"]`)||document.querySelector(`[onclick="showSection("${e}")"]`);a&&a.classList.add("active"),n.dataset.lazy&&!n.dataset.loaded?fetch(`sections/${e}.html`).then((t=>{if(!t.ok)throw new Error(`Failed to load ${e}: ${t.status} ${t.statusText}`);return t.text()})).then((t=>{n.innerHTML=t,n.dataset.loaded="true",setTimeout((()=>{"stats"===e&&loadStats(),"status"===e&&checkApiStatus(),"quiz"!==e||window.__quizInit||(initQuiz(),window.__quizInit=!0),"feedback"===e&&initFeedback()}),0)})).catch((t=>console.error(`Failed to load ${e}:`,t))):("stats"===e&&loadStats(),"status"===e&&checkApiStatus(),"quiz"!==e||window.__quizInit||(initQuiz(),window.__quizInit=!0),"feedback"!==e||window._feedback||(initFeedback(),window._feedback=!0));const s=document.getElementById("menuToggle"),i=document.getElementById("sidebar"),o=document.getElementById("backdrop");window.matchMedia("(max-width: 1024px)").matches&&i&&i.classList.contains("open")&&setTimeout((()=>{i.classList.remove("open"),o&&(o.hidden=!0),document.body.classList.remove("no-scroll"),s&&s.setAttribute("aria-expanded","false")}),0)}function initQuiz(){console.log("Initializing quiz...");const e=document.getElementById("quizMainSection");if(!e)return console.warn("Quiz section not found"),void setTimeout((()=>{const e=document.getElementById("quizMainSection");e?(console.log("Quiz section found on retry, initializing..."),initQuizContent(e)):console.error("Quiz section still not found after retry")}),100);initQuizContent(e)}function initQuizContent(e){const t=[{q:"Which of the following is a sign of a phishing email?",a:[{text:"An email from a known contact asking for a file",correct:!1},{text:"Grammatical errors and suspicious links",correct:!0},{text:"A secure website address (https://)",correct:!1},{text:"A welcome email from a trusted service",correct:!1}]},{q:"What should you do if a message asks for your password?",a:[{text:"Reply immediately with your password",correct:!1},{text:"Verify the source before responding",correct:!0},{text:"Ignore all emails from your company",correct:!1},{text:"Click the link and change your password",correct:!1}]},{q:"What is a phishing attack?",a:[{text:"A fishing technique used in rivers",correct:!1},{text:"A way to steal personal information via fake messages",correct:!0},{text:"A password recovery method",correct:!1},{text:"An antivirus scanning process",correct:!1}]}],n=e.querySelector("#quizProgress"),a=e.querySelector("#quizScore"),s=e.querySelector("#quizQuestion"),i=e.querySelector("#quizAnswers"),o=e.querySelector("#quizFeedback"),c=e.querySelector("#quizNextBtn"),r=e.querySelector("#quizRestartBtn");if(!(n&&a&&s&&i))return void console.warn("Missing required quiz elements:",{progress:!!n,score:!!a,question:!!s,answers:!!i});console.log("Quiz elements found, initializing game state...");let l=0,d=0,u=0;const g=1200;let m=parseInt(localStorage.getItem("surLinkBestQuiz")||"0",10);function p(){u&&(clearTimeout(u),u=0),n.textContent=`Question ${l+1} of ${t.length}`,a.textContent=`Score: ${d}`,s.textContent=t[l].q,i.innerHTML="",o.textContent="",c.disabled=!0,c.style.display="none",r.style.display="none",t[l].a.forEach((e=>{const n=document.createElement("button");n.className="quiz-answer",n.textContent=e.text,n.addEventListener("click",(()=>function(e,n){if(Array.from(i.children).forEach((e=>e.disabled=!0)),n)d++,e.classList.add("correct"),o.textContent="‚úÖ Correct!";else{e.classList.add("incorrect");const n=t[l].a.find((e=>e.correct)).text;o.textContent=`‚ùå Not quite. Correct: ${n}`}a.textContent=`Score: ${d}`,u=setTimeout(h,g)}(n,e.correct))),i.appendChild(n)}))}function h(){l<t.length-1?(l++,p()):function(){const e=Math.round(d/t.length*100);s.textContent=`You scored ${d} / ${t.length} (${e}%)!`,i.innerHTML="",o.textContent=e>=70?"üéâ Nice ‚Äî you passed!":"üîé Review the tips to improve.",c.style.display="none",r.style.display="inline-flex",e>m&&(m=e,localStorage.setItem("surLinkBestQuiz",String(m)),y(m))}()}function y(e){const t=document.querySelector(".stats-grid");if(!t)return;let n=document.getElementById("bestQuizStat");if(n)n.textContent=`${e}%`;else{const n=document.createElement("div");n.className="stat-item",n.innerHTML=`<span class="stat-number" id="bestQuizStat">${e}%</span><span class="stat-label">Best Quiz</span>`,t.appendChild(n)}}c.addEventListener("click",(()=>{clearTimeout(u),h()})),r.addEventListener("click",(()=>{l=0,d=0,c.style.display="inline-flex",r.style.display="none",p()})),p(),m>0&&y(m)}async function checkApiStatus(){const e=document.getElementById("statusMainSection");if(!e)return;const t=e.querySelector(".status-indicator"),n=e.querySelector(".status-text");if(t&&n)try{t.className="status-indicator checking",n.textContent="Checking...";const e=await fetch(`${apiUrl}/health`,{method:"GET",headers:{"Content-Type":"application/json"}}),a="Available";if(!e.ok)throw new Error("API not responding");t.className="status-indicator online",n.textContent=`Online (Explainer: ${a})`}catch(e){console.error("API Status Check Error:",e),t.className="status-indicator offline",n.textContent="Offline"}}function appendMessage(e,t="user",n=!1){const a=document.createElement("div");a.className=`message-bubble ${t}`;const s=document.createElement("div");s.className="bubble-content",s.innerHTML=n?'\n            <div class="typing-indicator">\n                AI is analyzing...\n                <div class="typing-dots">\n                    <span></span>\n                    <span></span>\n                    <span></span>\n                </div>\n            </div>\n        ':`\n            <div class="bubble-text">${e}</div>\n            <div class="timestamp">${(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}</div>\n        `,a.appendChild(s),chatWindow.appendChild(a),chatWindow.scrollTop=chatWindow.scrollHeight,adjustChatBottomPadding();const i=chatWindow.querySelector(".welcome-message");i&&"user"===t&&(i.style.display="none")}function showTypingIndicator(){appendMessage("","ai",!0),adjustChatBottomPadding()}function removeTypingIndicator(){const e=chatWindow.querySelector(".typing-indicator");e&&e.closest(".message-bubble").remove()}function animateProgressBar(){progressBar.classList.remove("hidden");const e=progressBar.querySelector(".progress-fill");e.style.width="0%";let t=0;const n=setInterval((()=>{t>=100?clearInterval(n):(t+=10,e.style.width=t+"%")}),100)}function hideProgressBar(){progressBar.classList.add("hidden"),adjustChatBottomPadding()}function displayScanResult(e,t,n=null){removeTypingIndicator(),hideProgressBar();const a=e.toLowerCase().includes("phishing"),s=a?"üö®":"‚úÖ",i=a?"#ef4444":"#10b981",o=localStorage.getItem("surLinkLang")||"en";let c=`\n        <div style="color: ${i}; font-weight: 600;">\n            ${s} <strong>${e}</strong>\n        </div>\n        <div style="margin-top: 8px; font-size: 0.9rem; opacity: 0.8;">\n            Confidence: <strong>${t}</strong>\n        </div>\n        <div id="ai-message">\n            ${a?translations[o].phishing_advice:translations[o].safe_advice}\n        </div>`;c+=null!==n?"__EXPLAINER_UNAVAILABLE__"===n?'\n      <div id="ai-explanation" style="margin-top: 12px; color: #f59e42; font-size: 0.95em;">\n        <strong>‚ö†Ô∏è Explanation currently not available.</strong><br>\n        <span style="opacity:0.8;">Too many users are requesting explanations right now. Please try again later.</span>\n      </div>\n      ':`\n      <div id="ai-explanation">\n        <div id="ai-explanation-title">${translations[o].why_decision}</div>\n        <div id="ai-explanation-content">${n}</div>\n      </div>`:'\n    <div id="ai-explanation" class="explanation-placeholder">\n      <div class="explanation-loading">\n        <div class="typing-dots">\n          <span></span><span></span><span></span>\n        </div>\n        Generating explanation...\n      </div>\n    </div>';let r=chatWindow.querySelector(".message-bubble.ai:last-child");if(!r||!r.classList.contains("pending-explanation")){r=document.createElement("div"),r.className="message-bubble ai pending-explanation";const e=document.createElement("div");e.className="bubble-content",r.appendChild(e),chatWindow.appendChild(r)}r.querySelector(".bubble-content").innerHTML=c,chatWindow.scrollTop=chatWindow.scrollHeight}async function scanMessage(){const e=messageInput.value.trim();if(e&&!isScanning){isScanning=!0,scanBtn.disabled=!0,scanBtn.innerHTML='<span class="btn-icon">‚è≥</span><span class="btn-text">Scanning...</span>',messageInput.value="",messageInput.style.height="auto",appendMessage(e,"user"),showTypingIndicator();try{const t=await fetch(`${apiUrl}/analyze`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const n=await t.json();displayScanResult(n.result,n.confidence),saveToHistory(e,n.result),updateStats(n.result);try{const t=await callExplainerModel(e,n.result);t&&displayScanResult(n.result,n.confidence,t)}catch(e){console.log("Explanation service unavailable:",e)}}catch(e){console.error("Scan Error:",e),removeTypingIndicator(),hideProgressBar(),appendMessage("\n            ‚ùå Connection Error<br>\n            <small>Unable to connect to the AI service. Please check your internet connection and try again.</small>\n        ","ai")}finally{isScanning=!1,scanBtn.disabled=!1,scanBtn.innerHTML='<span class="btn-icon">üîç</span><span class="btn-text">Scan</span>'}}}function formatResult(e){const t=localStorage.getItem("surLinkLang")||"en",{result:n,confidence:a}=e,s=n.toLowerCase().includes("phishing"),i=e&&"string"==typeof e.explanation&&e.explanation.trim()?e.explanation.trim():"";return`\n        <div style="color: ${s?"#ef4444":"#10b981"}; font-weight: 600;">\n            ${s?"üö®":"‚úÖ"} <strong>${n}</strong>\n        </div>\n        <div style="margin-top: 8px; font-size: 0.9rem; opacity: 0.8;">\n            Confidence: <strong>${a}</strong>\n        </div>\n        <div id="ai-message">\n            ${s?translations[t].phishing_advice:translations[t].safe_advice}\n        </div>\n        ${i?`\n        <div id="ai-explanation">\n            <div id="ai-explanation-title">${translations[t].why_decision}</div>\n            <div id="ai-explanation-content">${i.replace(/</g,"&lt;").replace(/>/g,"&gt;")}</div>\n        </div>`:""}\n    `}function saveToHistory(e,t){const n=document.getElementById("historyMainSection");if(!n)return;const a=n.querySelector("#historyList");if(!a)return;const s=t.toLowerCase().includes("phishing"),i=document.createElement("div");i.className="history-item "+(s?"phishing":"safe"),i.setAttribute("role","listitem");const o=e.length>50?e.substring(0,50)+"...":e;i.innerHTML=`\n        <div style="font-weight: 500; margin-bottom: 4px;">\n            ${s?"üö® Phishing":"‚úÖ Safe"}\n        </div>\n        <div style="font-size: 0.85rem; color: #cbd5e1;">\n            ${o}\n        </div>\n        <div style="font-size: 0.75rem; color: #64748b; margin-top: 4px;">\n            ${(new Date).toLocaleTimeString()}\n        </div>\n    `;const c=a.querySelector(".empty-history");c&&c.remove(),a.insertBefore(i,a.firstChild);const r=a.querySelectorAll(".history-item");r.length>10&&r[r.length-1].remove()}function updateStats(e){totalScans++,e.toLowerCase().includes("phishing")?phishingScans++:safeScans++;const t=document.getElementById("statsMainSection");if(!t)return;const n=t.querySelector("#totalScans"),a=t.querySelector("#phishingScans"),s=t.querySelector("#safeScans");n&&(n.textContent=totalScans),a&&(a.textContent=phishingScans),s&&(s.textContent=safeScans),saveStats()}function saveStats(){const e={totalScans:totalScans,phishingScans:phishingScans,safeScans:safeScans};localStorage.setItem("surLinkStats",JSON.stringify(e))}function loadStats(){const e=localStorage.getItem("surLinkStats");if(e){const t=JSON.parse(e);totalScans=t.totalScans||0,phishingScans=t.phishingScans||0,safeScans=t.safeScans||0;const n=document.getElementById("statsMainSection");if(n){const e=n.querySelector("#totalScans"),t=n.querySelector("#phishingScans"),a=n.querySelector("#safeScans");e&&(e.textContent=totalScans),t&&(t.textContent=phishingScans),a&&(a.textContent=safeScans)}}}function updateApiUrl(e){apiUrl=e,checkApiStatus()}function updateExplainerUrl(e){explainerUrl=e,checkApiStatus()}async function callExplainerModel(e,t){const n={en:`You are a robot that identifies phishing and safe messages. The message was classified as "${t}". Explain why this decision was made and point out any words or patterns that led to it. Limit your answer to 2‚Äì3 sentences. No greetings, introductions, or closing remarks Don't restate the message and whether the message was safe or phishing. Output only the explanation. Message:\n\n${e}`,tl:`Ikaw ay isang robot na nakakatukoy ng phishing at ligtas na mensahe. Ang mensahe ay na-classify bilang "${t}". Ipaliwanag kung bakit ganito ang naging desisyon at ituro ang mga salita o pattern na nagdulot nito. Limitahan ang sagot sa 2‚Äì3 pangungusap lang. Walang pagbati, pagpapakilala, o pangwakas na salita. Huwag ng ulitin ang mensahe at kung safe o phishing. Ilabas lang ang paliwanag. Mensahe:\n\n${e}`},a=n[localStorage.getItem("surLinkLang")||"en"]||n.en;try{if(window.apifree&&"function"==typeof apifree.chat){const e=await apifree.chat(a);if("string"==typeof e)return e.toLowerCase().includes("cooldown")||e.toLowerCase().includes("wait")||e.toLowerCase().includes("limit")?"__EXPLAINER_UNAVAILABLE__":e.trim();if(e&&"object"==typeof e){if(e.error&&(e.error.toLowerCase().includes("cooldown")||e.error.toLowerCase().includes("wait")||e.error.toLowerCase().includes("limit")))return"__EXPLAINER_UNAVAILABLE__";if(e.response)return String(e.response).trim();if(e.text)return String(e.text).trim()}return""}}catch(e){return console.warn("APIFree explain error",e),"__EXPLAINER_UNAVAILABLE__"}return""}function toggleTheme(){const e=document.body,t=document.getElementById("themeToggle"),n=document.querySelector(".theme-label");e.classList.contains("light-theme")?(e.classList.remove("light-theme"),localStorage.setItem("surLinkTheme","dark"),t.checked=!1,n&&(n.textContent="üåô Dark Theme")):(e.classList.add("light-theme"),localStorage.setItem("surLinkTheme","light"),t.checked=!0,n&&(n.textContent="‚òÄÔ∏è Light Theme"))}function loadTheme(){const e=localStorage.getItem("surLinkTheme"),t=document.body,n=document.getElementById("themeToggle"),a=document.querySelector(".theme-label");"light"===e?(t.classList.add("light-theme"),n&&(n.checked=!0),a&&(a.textContent="‚òÄÔ∏è Light Theme")):(t.classList.remove("light-theme"),n&&(n.checked=!1),a&&(a.textContent="üåô Dark Theme"))}function initFeedback(){const e=document.getElementById("submitFeedback"),t=document.getElementById("clearFeedback"),n=document.getElementById("feedbackMessage"),a=document.getElementById("feedbackStatus"),s=document.getElementById("feedbackType");if(!(e&&t&&n&&a&&s))return void console.error("Required feedback elements not found");const i=e.cloneNode(!0);e.parentNode.replaceChild(i,e);const o=t.cloneNode(!0);t.parentNode.replaceChild(o,t);let c=!1;i.addEventListener("click",(e=>{if(e.preventDefault(),c)return void console.log("Submission already in progress");s.value;const t=n.value.trim();if(!t||t.length<2)return console.log("Validation failed: message is empty or too short"),a.textContent="‚ö†Ô∏è Please enter meaningful feedback before submitting.",a.style.color="orange",a.classList.add("show"),void n.focus();c=!0,i.disabled=!0,n.disabled=!0,a.textContent="‚úÖ Thank you! Your feedback has been sent.",a.style.color="green",a.classList.add("show"),n.value="",setTimeout((()=>{c=!1,n.disabled=!1,i.disabled=!1,a.textContent="",a.classList.remove("show")}),3e3)})),o.addEventListener("click",(()=>{c||(n.value="",a.textContent="",a.classList.remove("show"),n.focus())}))}function setupImagePicker(){const e=document.getElementById("imagePicker");e&&e.addEventListener("change",(async()=>{const t=e.files&&e.files[0];if(!t)return;const n=scanBtn.innerHTML;scanBtn.innerHTML='<span class="btn-icon">‚è≥</span><span class="btn-text">Extracting...</span>',scanBtn.disabled=!0;try{const e=await createImageBitmap(t),n=document.createElement("canvas");n.width=e.width,n.height=e.height;n.getContext("2d").drawImage(e,0,0);const{data:{text:a}}=await Tesseract.recognize(n,"eng"),s=(a||"").trim();s&&(messageInput.value=s,messageInput.dispatchEvent(new Event("input")))}catch(e){console.error("Image OCR failed",e),alert("Failed to extract text from image. Please try again.")}finally{scanBtn.innerHTML=n,scanBtn.disabled=!1,e.value=""}}))}document.addEventListener("DOMContentLoaded",(function(){checkApiStatus(),setupEventListeners(),loadStats(),setupAccessibility(),addParticleEffect(),loadTheme(),setupMobileMenu(),updateUserUI(),setupImagePicker(),adjustChatBottomPadding();try{if("visualViewport"in window){const e=()=>{const e=window.visualViewport,t=Math.max(0,e&&e.height?window.innerHeight-e.height:0);document.documentElement.style.setProperty("--keyboard-offset",t+"px"),adjustChatBottomPadding();try{chatWindow.scrollTop=chatWindow.scrollHeight}catch(e){}};window.visualViewport.addEventListener("resize",e),window.visualViewport.addEventListener("scroll",e)}}catch(e){}})),chatWindow&&chatWindow.addEventListener("scroll",(()=>{chatWindow.classList.add("scrolling");const e=document.querySelector(".particles");e&&(e.style.animationPlayState="paused"),clearTimeout(scrollTimeout),scrollTimeout=setTimeout((()=>{chatWindow.classList.remove("scrolling"),e&&(e.style.animationPlayState="running")}),150)})),window.addEventListener("resize",adjustChatBottomPadding),window.addEventListener("orientationchange",adjustChatBottomPadding),setInterval(checkApiStatus,3e4);let authMode="login";function openLoginModal(){document.getElementById("authModal").classList.remove("hidden"),document.getElementById("sidebar").classList.remove("open")}function closeLoginModal(){document.getElementById("authModal").classList.add("hidden")}function switchAuthMode(e){e.preventDefault(),authMode="login"===authMode?"register":"login",document.getElementById("authTitle").innerText="login"===authMode?"Login":"Register",document.querySelector("#authModal button.scan-btn").innerText="login"===authMode?"Login":"Register",document.getElementById("authSwitch").innerHTML="login"===authMode?'Don\'t have an account? <a href="#" onclick="switchAuthMode(event)">Register here</a>':'Already have an account? <a href="#" onclick="switchAuthMode(event)">Login here</a>'}function handleAuthAction(){const e=document.getElementById("authEmail").value.trim(),t=document.getElementById("authPassword").value.trim();if(e&&t)if("register"===authMode)localStorage.setItem("surlinkUser",JSON.stringify({email:e,password:t})),alert("‚úÖ Registration successful! You can now log in."),switchAuthMode(new Event("click"));else{const n=JSON.parse(localStorage.getItem("surlinkUser"));n&&n.email===e&&n.password===t?(localStorage.setItem("surlinkLoggedIn","true"),localStorage.setItem("surlinkLoggedUser",e),localStorage.removeItem("surlinkGoogleName"),localStorage.removeItem("surlinkGooglePic"),updateUserUI(),closeLoginModal()):alert("‚ùå Invalid email or password")}else alert("Please fill in all fields")}function updateUserUI(){const e="true"===localStorage.getItem("surlinkLoggedIn"),t=localStorage.getItem("surlinkLoggedUser")||"",n=localStorage.getItem("surlinkGoogleName")||"",a=localStorage.getItem("surlinkGooglePic")||"",s=document.getElementById("loginBtn"),i=document.getElementById("logoutBtn"),o=document.getElementById("userEmail"),c=document.getElementById("userName"),r=document.getElementById("userPic");e?(i.classList.remove("hidden"),s.classList.add("hidden"),o.innerText=t||"",c.innerText=n||"",a?(r.src=a,r.style.display="block"):r.style.display="none"):(i.classList.add("hidden"),s.classList.remove("hidden"),o.innerText="Not logged in",c&&(c.innerText=""),r&&(r.style.display="none"))}function logout(){localStorage.removeItem("surlinkLoggedIn"),localStorage.removeItem("surlinkLoggedUser"),localStorage.removeItem("surlinkGoogleName"),localStorage.removeItem("surlinkGooglePic"),updateUserUI(),showMiniPopup("Logged out")}function showMiniPopup(e){let t=document.getElementById("miniPopup");t||(t=document.createElement("div"),t.id="miniPopup",t.style.position="fixed",t.style.bottom="32px",t.style.left="50%",t.style.transform="translateX(-50%)",t.style.background="linear-gradient(135deg,#6366f1,#8b5cf6)",t.style.color="#fff",t.style.padding="12px 28px",t.style.borderRadius="14px",t.style.fontWeight="600",t.style.fontSize="1rem",t.style.boxShadow="0 8px 24px rgba(99,102,241,0.25)",t.style.zIndex="99999",t.style.opacity="0",t.style.transition="opacity 0.3s",document.body.appendChild(t)),t.textContent=e,t.style.opacity="1",setTimeout((()=>{t.style.opacity="0"}),2e3)}function isSmallScreen(){return window.innerWidth<=1024}function updateCameraOptionVisibility(){const e=document.getElementById("imageOptionsDropdown"),t=e?.querySelector(".dropdown-option:first-child");t&&(isSmallScreen()?t.style.display="flex":t.style.display="none")}function toggleImageOptions(){const e=document.getElementById("imageOptionsDropdown");e&&(updateCameraOptionVisibility(),e.classList.toggle("hidden"))}function selectImage(){const e=document.getElementById("imagePicker");e&&e.click();const t=document.getElementById("imageOptionsDropdown");t&&t.classList.add("hidden")}function openCamera(){const e=document.getElementById("imagePicker");e&&(e.setAttribute("capture","environment"),e.click(),setTimeout((()=>{e.removeAttribute("capture")}),100));const t=document.getElementById("imageOptionsDropdown");t&&t.classList.add("hidden")}window.setGoogleUser=function(e){localStorage.setItem("surlinkLoggedIn","true"),localStorage.setItem("surlinkLoggedUser",e.email),localStorage.setItem("surlinkGoogleName",e.name),localStorage.setItem("surlinkGooglePic",e.picture),updateUserUI(),closeLoginModal()},window.addEventListener("load",(()=>{updateUserUI()})),document.addEventListener("click",(function(e){const t=document.getElementById("imageOptionsDropdown"),n=document.getElementById("imageOptionsBtn");!t||t.classList.contains("hidden")||n.contains(e.target)||t.contains(e.target)||t.classList.add("hidden")})),window.addEventListener("load",(()=>{const e=document.getElementById("splashScreen");setTimeout((()=>{e.classList.add("hide"),setTimeout((()=>{"function"==typeof window.startOnboarding&&window.startOnboarding()}),300)}),1900)})),function(){const e=document.getElementById("sidebar"),t=document.getElementById("backdrop"),n=document.getElementById("menuToggle");let a=0,s=0,i=!1;document.addEventListener("touchstart",(t=>{window.matchMedia("(max-width:1024px)").matches&&(a=t.touches[0].clientX,s=t.touches[0].clientY,a<=1e3&&!e.classList.contains("open")&&(i="open"),e.classList.contains("open")&&a>=e.offsetWidth-50&&(i="close"))})),document.addEventListener("touchmove",(o=>{if(!i)return;const c=o.touches[0].clientX-a,r=o.touches[0].clientY-s;Math.abs(r)>Math.abs(c)?i=!1:("open"===i&&c>80&&(e.classList.add("open"),t&&(t.hidden=!1,t.style.pointerEvents="auto",t.style.opacity="0.4"),n&&n.setAttribute("aria-expanded","true"),document.body.classList.add("no-scroll"),i=!1),"close"===i&&c<-80&&(e.classList.remove("open"),t&&(t.hidden=!0,t.style.pointerEvents="none"),n&&n.setAttribute("aria-expanded","false"),document.body.classList.remove("no-scroll"),i=!1))})),document.addEventListener("touchend",(()=>{i=!1}))}();const translations={en:{title:"S√ªrLink",tagline:"Built to Detect, Designed to Protect",chat_scanner:"Chat Scanner",scan_history:"Scan History",statistics:"Statistics",quiz:"Quiz",api_status:"API Status",feedback:"Feedback",account:"Account",not_logged_in:"Not logged in",login_register:"Login / Register",logout:"Logout",appearance:"Appearance",dark_theme:"üåô Dark Theme",welcome:"Welcome to S√ªrLink",welcome_desc:"I'm here to help you detect phishing attempts in messages, emails, and text content using advanced AI technology.",try_examples:"Try these examples:",example1:"Your account has been suspended. Click here to verify immediately.",example2:"Congratulations! You've won $1000. Claim your prize now.",example3:"Your package is ready for pickup. Click to confirm delivery.",message_placeholder:"Enter your message here...",scan:"Scan",recent_scans:"Recent Scans",no_scans:"No scans yet",scan_statistics:"Scan Statistics",total_scans:"Total Scans",phishing_detected:"Phishing Detected",safe_messages:"Safe Messages",checking:"Checking...",feedback_title:"We value your feedback",feedback_type:"Feedback Type",suggestion:"üí° Suggestion",bug:"üêû Bug Report",question:"‚ùì Question",your_feedback:"Your Feedback",feedback_placeholder:"Type your feedback here...",submit:"Submit",clear:"Clear",login:"Login",register:"Register",or:"OR",dont_have_account:"Don't have an account? Register here",already_have_account:"Already have an account? Login here",safe_advice:"‚úÖ This message appears safe.<br><br>üëâ <b>What to do:</b> You can continue normally, but stay alert for anything unusual.<br><br>üí° <b>Safety tips:</b><br>‚Ä¢ Double-check the sender/source if unsure.<br>‚Ä¢ Be careful with unexpected links or files.<br>‚Ä¢ Keep your device and security tools updated.<br>‚Ä¢ When in doubt, verify through official channels.",phishing_advice:"‚ö†Ô∏è This message looks suspicious and may be a phishing attempt.<br><br>üëâ <b>What to do:</b> Do not reply, share personal details, or click any links/attachments.<br><br>üõ°Ô∏è Best action: ignore, delete, or report it.<br><br>üîí <b>How to avoid phishing:</b><br>‚Ä¢ Check the sender‚Äôs email/number carefully.<br>‚Ä¢ Watch for spelling mistakes or odd grammar.<br>‚Ä¢ Don‚Äôt trust urgent scare tactics like ‚Äúact now‚Äù.<br>‚Ä¢ Use official apps or websites instead of in-message links.",why_decision:"Why this decision"},tl:{title:"S√ªrLink",tagline:"Gawa para Mag-detect, Disenyo para Magprotekta",chat_scanner:"Chat Scanner",scan_history:"Kasaysayan ng Scan",statistics:"Istatistika",quiz:"Pagsusulit",api_status:"Kalagayan ng API",feedback:"Puna",account:"Account",not_logged_in:"Hindi naka-login",login_register:"Login / Rehistro",logout:"Logout",appearance:"Hitsura",dark_theme:"üåô Madilim",welcome:"Maligayang Pagdating sa S√ªrLink",welcome_desc:"Narito ako para tulungan kang matukoy ang mga pagtatangkang phishing sa mga mensahe, email, at teksto gamit ang makabagong AI technology.",try_examples:"Subukan ang mga halimbawang ito:",example1:"Ang iyong account ay nasuspinde. I-click dito para agad na ma-verify.",example2:"Binabati kita! Nanalo ka ng $1000. I-claim ang iyong premyo ngayon.",example3:"Handa na ang iyong package para kunin. I-click para kumpirmahin ang delivery.",message_placeholder:"Ilagay ang iyong mensahe dito...",scan:"I-scan",recent_scans:"Mga Kamakailang Scan",no_scans:"Wala pang scan",scan_statistics:"Istatistika ng Scan",total_scans:"Kabuuang Scan",phishing_detected:"Natukoy na Phishing",safe_messages:"Ligtas na Mensahe",checking:"Sinusuri...",feedback_title:"Pinahahalagahan namin ang iyong puna",feedback_type:"Uri ng Puna",suggestion:"üí° Suhestiyon",bug:"üêû Ulat ng Bug",question:"‚ùì Tanong",your_feedback:"Iyong Puna",feedback_placeholder:"I-type ang iyong puna dito...",submit:"Ipasa",clear:"I-clear",login:"Login",register:"Rehistro",or:"O",dont_have_account:"Wala ka pang account? Mag-rehistro dito",already_have_account:"May account ka na? Mag-login dito",safe_advice:"‚úÖ Ang mensaheng ito ay mukhang ligtas.<br><br>üëâ <b>Anong gagawin:</b> Maaari kang magpatuloy, ngunit manatiling alerto sa anumang kakaiba.<br><br>üí° <b>Mga tip sa kaligtasan:</b><br>‚Ä¢ Suriing mabuti ang pinagmulan kung nagdududa.<br>‚Ä¢ Mag-ingat sa di-inaasahang link o file.<br>‚Ä¢ Panatilihing updated ang iyong device at security tools.<br>‚Ä¢ Kapag nagdududa, mag-verify sa opisyal na paraan.",phishing_advice:"‚ö†Ô∏è Ang mensaheng ito ay kahina-hinala at maaaring phishing attempt.<br><br>üëâ <b>Anong gagawin:</b> Huwag sumagot, magbahagi ng personal na detalye, o mag-click ng anumang link/attachment.<br><br>üõ°Ô∏è Pinakamainam: balewalain, burahin, o i-report ito.<br><br>üîí <b>Paano iwasan ang phishing:</b><br>‚Ä¢ Suriing mabuti ang email/number ng nagpadala.<br>‚Ä¢ Mag-ingat sa maling spelling o kakaibang grammar.<br>‚Ä¢ Huwag magtiwala sa mga nagmamadaling pananakot tulad ng ‚Äúkumilos agad‚Äù.<br>‚Ä¢ Gamitin ang opisyal na app o website sa halip na link sa mensahe.",why_decision:"Bakit ito ang desisyon"}};function applyTranslations(e){document.querySelectorAll("[data-i18n]").forEach((t=>{const n=t.getAttribute("data-i18n");translations[e][n]&&(t.innerHTML=translations[e][n])})),messageInput&&translations[e].message_placeholder&&(messageInput.placeholder=translations[e].message_placeholder);const t=document.getElementById("feedbackMessage");t&&translations[e].feedback_placeholder&&(t.placeholder=translations[e].feedback_placeholder);const n=document.getElementById("authTitle");n&&translations[e][authMode]&&(n.innerText=translations[e][authMode]);const a=document.querySelector("#authModal button.scan-btn");a&&translations[e][authMode]&&(a.innerText=translations[e][authMode]);const s=document.getElementById("authSwitch");s&&(s.innerHTML="login"===authMode?translations[e].dont_have_account:translations[e].already_have_account);const i=document.getElementById("feedbackType");i&&(i.options[0].text=translations[e].suggestion,i.options[1].text=translations[e].bug,i.options[2].text=translations[e].question);const o=document.getElementById("submitFeedback");o&&translations[e].submit&&(o.innerText=translations[e].submit);const c=document.getElementById("clearFeedback");if(c&&translations[e].clear&&(c.innerText=translations[e].clear),scanBtn&&translations[e].scan){const t=scanBtn.querySelector(".btn-text");t&&(t.innerText=translations[e].scan)}}function applyTranslations(e){document.querySelectorAll("[data-i18n]").forEach((t=>{const n=t.getAttribute("data-i18n");translations[e][n]&&(t.innerHTML=translations[e][n])})),messageInput&&translations[e].message_placeholder&&(messageInput.placeholder=translations[e].message_placeholder);document.querySelectorAll(".message-bubble.ai").forEach((t=>{const n=t.querySelector(".bubble-content");if(n){const t=n.innerHTML.match(/<strong>(.*?)<\/strong>/),a=n.innerHTML.match(/Confidence: <strong>(.*?)<\/strong>/),s=n.innerHTML.match(/<div style="white-space: pre-wrap; line-height:1.5;">([\s\S]*?)<\/div>/);let i=t?t[1]:"",o=a?a[1]:"",c=s?s[1]:"";const r=i.toLowerCase().includes("phishing"),l=r?"üö®":"‚úÖ",d=r?"#ef4444":"#10b981",u=r?translations[e].phishing_advice:translations[e].safe_advice;n.innerHTML=`\n        <div style="color: ${d}; font-weight: 600;">\n            ${l} <strong>${i}</strong>\n        </div>\n        <div style="margin-top: 8px; font-size: 0.9rem; opacity: 0.8;">\n            Confidence: <strong>${o}</strong>\n        </div>\n        <div id="ai-message">\n            ${u}\n        </div>\n        ${c?`\n        <div id="ai-explanation">\n            <div id="ai-explanation-title">${translations[e].why_decision}</div>\n            <div id="ai-explanation-content">${c}</div>\n        </div>`:""}\n      `}}))}const langSelect=document.getElementById("languageSelect");langSelect&&langSelect.addEventListener("change",(function(){const e=this.value;localStorage.setItem("surLinkLang",e),applyTranslations(e)})),window.addEventListener("DOMContentLoaded",(()=>{const e=localStorage.getItem("surLinkLang")||"en",t=document.getElementById("languageSelect");t&&(t.value=e),applyTranslations(e)}));